{% extends "base.html" %}
{% block title %}CV Analyzer - Upload{% endblock %}
{% block content %}
<div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Analyze Your CV Against a Job Description</h1>
    <p class="text-gray-500">Paste text or upload a file (PDF, DOCX, TXT) for both your CV and the target JD.</p>
</div>

<form action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <!-- CV Panel -->
        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold text-indigo-700 mb-4">Your CV / Resume</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-600 mb-1">Upload file</label>
                <input type="file" name="cv_file" accept=".pdf,.docx,.txt" id="cv_file"
                       class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                <p class="text-xs text-gray-400 mt-1" id="cv_file_name"></p>
            </div>
            <div class="relative">
                <label class="block text-sm font-medium text-gray-600 mb-1">Or paste text</label>
                <textarea name="cv_text" id="cv_text" rows="12"
                          class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-400 focus:border-transparent resize-y"
                          placeholder="Paste your CV content here..."></textarea>
            </div>
        </div>

        <!-- JD Panel -->
        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold text-indigo-700 mb-4">Job Description</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-600 mb-1">Upload file</label>
                <input type="file" name="jd_file" accept=".pdf,.docx,.txt" id="jd_file"
                       class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                <p class="text-xs text-gray-400 mt-1" id="jd_file_name"></p>
            </div>
            <div class="relative">
                <label class="block text-sm font-medium text-gray-600 mb-1">Or paste text</label>
                <textarea name="jd_text" id="jd_text" rows="12"
                          class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-400 focus:border-transparent resize-y"
                          placeholder="Paste the job description here..."></textarea>
            </div>
        </div>
    </div>

    <div class="text-center">
        <button type="submit"
                class="bg-indigo-700 hover:bg-indigo-800 text-white font-semibold py-3 px-10 rounded-lg shadow transition">
            Analyze CV
        </button>
    </div>
</form>

<script>
document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function() {
        const label = document.getElementById(this.id + '_name');
        const textarea = document.getElementById(this.id.replace('_file', '_text'));
        if (this.files.length > 0) {
            label.textContent = 'Selected: ' + this.files[0].name + ' (file will be used instead of text)';
            textarea.style.opacity = '0.4';
            textarea.setAttribute('placeholder', 'File selected â€” text input will be ignored.');
        } else {
            label.textContent = '';
            textarea.style.opacity = '1';
            textarea.setAttribute('placeholder', this.id.includes('cv') ? 'Paste your CV content here...' : 'Paste the job description here...');
        }
    });
});
</script>
{% endblock %}
