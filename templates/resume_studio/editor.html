{% extends "dashboard_base.html" %}
{% block title %}Resume Editor — LevelUpX{% endblock %}
{% block page_title %}Resume Editor{% endblock %}
{% block page_subtitle %}
<p class="text-xs text-slate-500 mt-0.5">Create or edit your resume with live preview</p>
{% endblock %}

{% block content %}
<div class="max-w-7xl anim-fade-up">

    <!-- ═══════ Header Bar ═══════ -->
    <div class="flex flex-wrap items-center justify-between gap-3 mb-5">
        <div class="flex items-center gap-3">
            <a href="/resume-studio/library" class="text-slate-400 hover:text-slate-600 transition" title="Back to My Resumes">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
            </a>
            <div class="flex items-center gap-2">
                <label class="text-xs font-medium text-slate-500">Name:</label>
                <input id="resume-label" type="text" value="My Resume"
                    placeholder="Resume name..."
                    class="px-3 py-1.5 text-sm font-medium border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none w-48">
            </div>
        </div>
        <div class="flex items-center gap-2">
            <label class="flex items-center gap-2 text-xs text-slate-500 cursor-pointer">
                <input id="is-primary" type="checkbox" class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                Set as Primary
            </label>
            <button onclick="exportPDF()" class="inline-flex items-center gap-1.5 px-4 py-2 text-xs font-medium text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                Export PDF
            </button>
            <button id="save-btn" onclick="saveResume()" class="inline-flex items-center gap-1.5 px-5 py-2 text-xs font-semibold text-white bg-gradient-to-r from-brand-600 to-emerald-500 hover:from-brand-700 hover:to-emerald-600 rounded-lg shadow-md transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                Save
            </button>
        </div>
    </div>

    <!-- ═══════ Mobile Preview Toggle ═══════ -->
    <button id="mobile-preview-toggle" onclick="toggleMobilePreview()"
        class="lg:hidden w-full mb-4 py-2 text-sm font-medium text-brand-600 bg-brand-50 rounded-lg border border-brand-200 hover:bg-brand-100 transition">
        Show Preview
    </button>

    <!-- ═══════ Two-Column Layout ═══════ -->
    <div class="flex flex-col lg:flex-row gap-5">

        <!-- LEFT: Form Panel -->
        <div class="w-full lg:w-1/2">
            <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">

                <!-- Section Tabs -->
                <div class="flex flex-wrap gap-1 p-3 bg-slate-50 border-b border-slate-100">
                    <button data-section-tab="basics" onclick="switchSection('basics')"
                        class="px-3 py-1.5 text-xs rounded-lg transition bg-white shadow-sm text-brand-700 font-semibold">
                        Basics
                    </button>
                    <button data-section-tab="work" onclick="switchSection('work')"
                        class="px-3 py-1.5 text-xs rounded-lg transition text-slate-500">
                        Work
                    </button>
                    <button data-section-tab="education" onclick="switchSection('education')"
                        class="px-3 py-1.5 text-xs rounded-lg transition text-slate-500">
                        Education
                    </button>
                    <button data-section-tab="skills" onclick="switchSection('skills')"
                        class="px-3 py-1.5 text-xs rounded-lg transition text-slate-500">
                        Skills
                    </button>
                    <button data-section-tab="projects" onclick="switchSection('projects')"
                        class="px-3 py-1.5 text-xs rounded-lg transition text-slate-500">
                        Projects
                    </button>
                    <button data-section-tab="more" onclick="switchSection('more')"
                        class="px-3 py-1.5 text-xs rounded-lg transition text-slate-500">
                        More
                    </button>
                </div>

                <!-- Form Content -->
                <div id="form-section-content" class="p-5 max-h-[70vh] overflow-y-auto">
                    <!-- Rendered dynamically by JS -->
                </div>
            </div>
        </div>

        <!-- RIGHT: Preview Panel -->
        <div id="preview-panel" class="w-full lg:w-1/2 hidden lg:block">
            <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">

                <!-- Preview Header -->
                <div class="px-4 py-3 bg-slate-50 border-b border-slate-100 flex items-center justify-between">
                    <span class="text-xs font-semibold text-slate-500">Live Preview</span>
                    <span class="text-[10px] text-slate-400">Updates as you type</span>
                </div>

                <!-- Preview Iframe -->
                <div class="p-4 bg-slate-100">
                    <div class="bg-white shadow-xl rounded-lg overflow-hidden" style="aspect-ratio: 210/297;">
                        <iframe id="preview-frame" class="w-full h-full border-0" title="Resume Preview"></iframe>
                    </div>
                </div>

                <!-- Template Selector -->
                <div class="px-4 py-3 border-t border-slate-100">
                    <p class="text-[10px] font-semibold text-slate-400 uppercase tracking-wider mb-2">Template</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button data-template-id="classic" onclick="switchTemplate('classic')"
                            class="py-2 px-3 text-xs font-medium rounded-lg border-2 border-brand-500 ring-2 ring-brand-500 bg-white hover:bg-slate-50 transition text-center">
                            Classic
                        </button>
                        <button data-template-id="modern" onclick="switchTemplate('modern')"
                            class="py-2 px-3 text-xs font-medium rounded-lg border-2 border-slate-200 bg-white hover:bg-slate-50 transition text-center">
                            Modern
                        </button>
                        <button data-template-id="minimal" onclick="switchTemplate('minimal')"
                            class="py-2 px-3 text-xs font-medium rounded-lg border-2 border-slate-200 bg-white hover:bg-slate-50 transition text-center">
                            Minimal
                        </button>
                        <button data-template-id="professional" onclick="switchTemplate('professional')"
                            class="py-2 px-3 text-xs font-medium rounded-lg border-2 border-slate-200 bg-white hover:bg-slate-50 transition text-center">
                            Professional
                        </button>
                        <button data-template-id="creative" onclick="switchTemplate('creative')"
                            class="py-2 px-3 text-xs font-medium rounded-lg border-2 border-slate-200 bg-white hover:bg-slate-50 transition text-center">
                            Creative
                        </button>
                        <button data-template-id="compact" onclick="switchTemplate('compact')"
                            class="py-2 px-3 text-xs font-medium rounded-lg border-2 border-slate-200 bg-white hover:bg-slate-50 transition text-center">
                            Compact
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Load Handlebars CDN -->
<script src="https://cdn.jsdelivr.net/npm/handlebars@4.7.8/dist/handlebars.min.js"></script>
<!-- Load resume templates -->
<script src="{{ url_for('static', filename='js/resume-templates.js') }}"></script>
<!-- Load editor logic -->
<script src="{{ url_for('static', filename='js/resume-editor.js') }}"></script>

<script>
    // Initialize editor with server data (if editing an existing resume)
    document.addEventListener('DOMContentLoaded', function() {
        initEditor({{ editor_data | tojson | safe }});
    });
</script>
{% endblock %}
